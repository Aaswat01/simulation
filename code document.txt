________________________________________
ðŸ“˜ PROJECT DOCUMENTATION
Project: Location-First AI Navigation System (Leaflet + OSRM)
File Type: Single-page Web Application (HTML + CSS + JavaScript)
Purpose: Real-time GPS navigation with AI driving assistance, voice guidance, rerouting, eco-tips, and Google-Maps-style UX.
________________________________________
1âƒ£ HIGH-LEVEL SYSTEM OVERVIEW
This system is a client-side navigation engine that:
â€¢ Tracks real-time user GPS
â€¢ Displays a rotating, compass-based map
â€¢ Builds routes using OSRM (Open Source Routing Machine)
â€¢ Generates step-by-step navigation instructions
â€¢ Monitors driver behavior (speed, route deviation)
â€¢ Gives AI-based eco driving suggestions
â€¢ Automatically reroutes if driver goes off-route
â€¢ Supports manual map selection, search, and voice input

________________________________________
3âƒ£ MAIN SYSTEM STATES
State	                 |Description
------------------------------------------------------------
Idle	                 |User moving without navigation
Preview	               |Destination selected but not started
Navigation             |Active route guidance
Rerouting	             |Off-route detected
Arrival	               |Destination reached
------------------------------------------------------------
________________________________________
4âƒ£ GLOBAL VARIABLES (SYSTEM MEMORY)
Navigation            |   State:
--------------------------------------------------------------
Variable	            |   Purpose
routes[]	            |   Stores all active routes
activeRouteIndex	    |   Which route is currently followed
currentStepIndex	    |   Current navigation instruction
waypoints[]	          |   Ordered navigation points
waypointMarkers[]	    |   Map markers for waypoints
--------------------------------------------------------------

GPS / Motion:
Variable	Purpose
userMarker	Vehicle position on map
lastHeading	Direction of movement
useVirtualGPS	Simulated GPS fallback


AI / Speech:
Variable	Purpose
SPEECH	Speech state, cooldowns, memory
announcedSteps	Prevents repeat announcements
________________________________________
5âƒ£ FUNCTION-BY-FUNCTION DOCUMENTATION
________________________________________
ðŸ”¹ safeFetch(url, retries):
Purpose
Controls API calls safely by queuing requests and preventing overload.
Inputs
â€¢ url â†’ API endpoint
â€¢ retries â†’ Retry count
Source of Inputs
Called by routing, elevation, and search systems.
Outputs
â€¢ Returns a resolved fetch() response
â€¢ Or rejects on failure
Used By
â€¢ OSRM routing
â€¢ Elevation API
â€¢ Search APIs

________________________________________
ðŸ”¹ processQueue()  :
Purpose
Executes queued API calls one-by-one with rate limiting.
Inputs
None (uses global request queue)
Outputs
â€¢ API responses processed safely
Used By
â€¢ safeFetch()

________________________________________
ðŸ”¹ aiBoxShow(kind, text)  :
Purpose
Updates the AI tip banner at the top of the UI.
Inputs
â€¢ kind â†’ eco / step / warning
â€¢ text â†’ Message to show
Outputs
â€¢ Updates DOM element #ai-tip
Used By
â€¢ Speech system
â€¢ Eco advisor
â€¢ Step announcements

________________________________________
ðŸ”¹ speak(text, kind, options)  :
Purpose
Plays voice instructions using Web Speech API.
Inputs
â€¢ text â†’ Speech content
â€¢ kind â†’ eco / step / warning
â€¢ options.interrupt â†’ Cancel previous speech
Outputs
â€¢ Audible voice output
â€¢ Updates speech memory
Used By
â€¢ Navigation steps
â€¢ Speed warnings
â€¢ Eco tips

________________________________________
ðŸ”¹ buildPreviewRoute(startLL, endLL, label)  :
Purpose
Creates a temporary route preview before navigation starts.
Inputs
â€¢ startLL â†’ Starting LatLng
â€¢ endLL â†’ Destination LatLng
â€¢ label â†’ Destination name
Outputs
â€¢ Blue preview polyline
â€¢ Distance & duration shown in approval panel
Used By
â€¢ Search selection
â€¢ Map click selection
________________________________________
ðŸ”¹ openPreviewTo(latlng, label, addMarker)
Purpose
Handles destination selection & confirmation workflow.
Inputs
â€¢ latlng â†’ Selected point
â€¢ label â†’ Name
â€¢ addMarker â†’ Boolean
Outputs
â€¢ Popup marker
â€¢ Voice confirmation
â€¢ Preview route created
Used By
â€¢ Search results
â€¢ Map click
â€¢ Voice search

________________________________________
ðŸ”¹ createRoute(start, end, color, marker)  :
Purpose
Creates a final navigable route using OSRM.
Inputs
â€¢ start â†’ Start point
â€¢ end â†’ End point
â€¢ color â†’ Route color
â€¢ marker â†’ Destination marker
Outputs
â€¢ OSRM route control
â€¢ Step list UI
â€¢ Step polylines
â€¢ Voice instruction
Used By
â€¢ Approval panel
â€¢ GM route panel

________________________________________
ðŸ”¹ adaptiveAIDashboard(latlng, heading)  :
Purpose
Central AI brain that updates everything every second.
Inputs
â€¢ latlng â†’ Current position
â€¢ heading â†’ Movement direction
Outputs
â€¢ Speed UI
â€¢ Gear UI
â€¢ Throttle UI
â€¢ Eco advice
â€¢ Warnings
â€¢ Step tracking
Used By
â€¢ GPS watcher
â€¢ Virtual GPS

________________________________________
ðŸ”¹ calculateGPSSpeed(latlng)  : 
Purpose
Calculates speed based on GPS movement.
Inputs
â€¢ latlng â†’ Current position
Outputs
â€¢ Speed in km/h
Used By
â€¢ Eco advisor
â€¢ Speed warnings
â€¢ Road type detection
________________________________________
ðŸ”¹ ecoAdvisor(distance, slope)  : 
Purpose
Generates eco-driving recommendations.
Inputs
â€¢ distance â†’ Lookahead distance
â€¢ slope â†’ Road gradient
Outputs
â€¢ Recommended speed
â€¢ Gear
â€¢ Throttle
â€¢ Tip text
Used By
â€¢ AI dashboard
â€¢ Voice system

________________________________________
ðŸ”¹ predictElevationAhead(latlng, heading)  :  
Purpose
Predicts upcoming slope using Open-Elevation API.
Inputs
â€¢ latlng
â€¢ heading
Outputs
â€¢ Elevation array
â€¢ Average slope
Used By
â€¢ Eco advisor
________________________________________
ðŸ”¹ smartStepAdvancement(latlng)
Purpose
Detects which navigation step the driver is actually on.
Inputs
â€¢ latlng
Outputs
â€¢ Updates current step
â€¢ Skips missed steps
â€¢ Announces correct instruction
Used By
â€¢ AI dashboard
________________________________________
ðŸ”¹ checkUpcomingSteps(latlng)  : 
Purpose
Announces upcoming turns in advance.
Inputs
â€¢ latlng
Outputs
â€¢ Voice instruction when within range
Used By
â€¢ Navigation loop
________________________________________
ðŸ”¹ safeReroute(route, currentLL)  :
Purpose
Recalculates route when driver goes off-path.
Inputs
â€¢ route â†’ Active route object
â€¢ currentLL â†’ Current position
Outputs
â€¢ New route
â€¢ Reset steps
â€¢ Voice announcement
Used By
â€¢ Off-route detection logic
________________________________________
ðŸ”¹ getSearchResults(query)  : 
Purpose
Next-gen search engine (Photon + Nominatim + Wikipedia).
Inputs
â€¢ query â†’ User text
Outputs
â€¢ Ranked location results
Used By
â€¢ Search bar
â€¢ GM route panel

________________________________________
7âƒ£ WHY THIS DESIGN IS CORRECT
âœ” Location-first (not instruction-first)
âœ” Prevents step mismatch
âœ” API-safe (rate-limited)
âœ” Works offline partially
âœ” Scalable for future AI models
âœ” Clean separation of concerns
________________________________________



